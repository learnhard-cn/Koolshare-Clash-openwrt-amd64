# 分支版本变更信息
> 原作者开发的版本太老了，因此个人在此基础上更新了一个新的分支版本，也因为改动较多，就不再提交合并到原作者的版本了。

## 安装前说明

切记!切记!切记! 如果第一次安装插件，需要先安装 **fuckkoolshare.tar.gz** 后才能安装 **koolclash.tar.gz**!!!

## 详细变更信息记录

本意：更新插件的clash版本，以及一些不可用功能的优化处理，比如测速功能的删除(没有意义，且会给第三方网站提供上报信息,安全性谁知道呢).


### 优化开发-koolclash插件-v1.0

1. UI优化，去掉测速功能
2. 增加yacd界面
3. 优化iptables规则：重定向的数据规则：所有数据都重定向到clash处理。
4. 优化Country.mmdb更新地址，更全面的IP信息。
5. 脚本优化:生成 config.yaml 文件格式美化处理
6. 更换程序: clash升级为premium版本(Clash Premium 2021.09.15 版本) 和 yq 升级到4.2.1版本(yq版本 2.x 升级到 4.x 基本上用法完全不一样，改动较多)

### 为什么更新到 [Clash Premium 2021.09.15 版本](https://github.com/vlikev/clash_binary/tree/f3c4db627f8d091682dc26d5bfe5efd7ad93a8f4/premium/)呢？

可以从Clash开源的代码里看到， Clash 对应的这个版本是使用**文件方式**保存节点选择信息，保存信息目的是为了重启clash后可以不用重新手工设置节点选择信息，但下一个版本**2021.11.08**(对应v1.8.0)版本就更换为名为**cache.db**文件保存信息(代码里是使用了第三方k/v库**bbolt**,但在一些arm、以及x86_64等路由器里无法正常工作)，而似乎这个问题作者一直无法修复(解释市可能跟依赖库go.etcd.io/bbolt有关)。

因此，就更换一下clash版本就可以了。



## v1.1版本修改内容

1. 合并多个脚本内容到一个脚本: koolclash_main.sh
2. 修改 Module_koolclash.asp 页面JS调用 koolclash_main.sh 脚本交互。
3. 增加 个人节点添加、删除功能,节点配置保存在 **providers/provider_diy.yaml**文件中，想使用就添加个文件订阅配置。
4. 增加了默认启动配置文件，**安装即用**。

## 如何让主路由自动识别下线软路由器并自动修复配置规则？


当软路由下线时，我们需要手工修改主路由器上的默认网关和DNS服务器等配置信息，否则内网就会无法上网。

写一个自动检测 软路由在线监测脚本，主要功能如下：

1. 软路由下线检测：如果软路由IP地址A 找不到了，自动修改默认网关、DNS服务器为主路由器IP地址B ~~,并且自动启动 Clash 客户端~~。
2. 软路由上线检测：如果软路由IP地址A 上线了，自动修改默认网关、DNS服务器为软路由器IP地址A。


